import React, { useState, useRef, useEffect } from "react";
import interact from "interactjs";

const Layer = ({ onTextureGenerated, onRotationChange, canvasRef }) => {
  const [selectedPath, setSelectedPath] = useState(null);
  const [color, setColor] = useState("#000000");
  const [uploadedImage, setUploadedImage] = useState(null);
  const svgRef = useRef(null);
  const containerRef = useRef(null);
  const imgRef = useRef(null);
  const textureCanvasRef = useRef(null);
  const [imgSize, setImgSize] = useState({ width: 200, height: 200 });
  const [imgPosition, setImgPosition] = useState({ x: 50, y: 50 });
  const [rotation, setRotation] = useState(0);
  const [scale, setScale] = useState(1);

  useEffect(() => {
    if (!svgRef.current) return;
    const paths = svgRef.current.querySelectorAll("path");
    paths.forEach((path) => {
      path.addEventListener("click", (e) => {
        setSelectedPath(path);
      });
    });
    return () => {
      paths.forEach((path) => {
        path.removeEventListener("click", () => setSelectedPath(path));
      });
    };
  }, []);

  useEffect(() => {
    if (selectedPath) {
      selectedPath.style.fill = color;
      exportAsTexture();
    }
  }, [color, selectedPath]);

  useEffect(() => {
    if (!imgRef.current || !uploadedImage) return;

    const element = imgRef.current;

    interact(element).draggable({
      modifiers: [
        interact.modifiers.restrictRect({
          restriction: 'parent',
          endOnly: true
        })
      ],
      listeners: {
        move(event) {
          const target = event.target;
          const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
          const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

          target.style.transform = `translate(${x}px, ${y}px) rotate(${rotation}deg)`;
          target.setAttribute('data-x', x);
          target.setAttribute('data-y', y);
          setImgPosition({ x, y });
        },
        end() {
          exportAsTexture();
        }
      }
    })
      .resizable({
        edges: { left: true, right: true, bottom: true, top: true },
        modifiers: [
          interact.modifiers.restrictEdges({
            outer: 'parent',
            endOnly: true
          })
        ],
        listeners: {
          move(event) {
            let { width, height } = event.rect;
            width = Math.max(50, width);
            height = Math.max(50, height);

            const target = event.target;
            target.style.width = `${width}px`;
            target.style.height = `${height}px`;
            setImgSize({ width, height });
          },
          end() {
            exportAsTexture();
          }
        }
      })
      .gesturable({
        listeners: {
          move(event) {
            const target = event.target;
            const rotation = (parseFloat(target.getAttribute('data-rotation')) || 0) + event.angle;
            target.style.transform = `translate(${imgPosition.x}px, ${imgPosition.y}px) rotate(${rotation}deg)`;
            target.setAttribute('data-rotation', rotation);
            setRotation(rotation);
          },
          end() {
            exportAsTexture();
          }
        }
      });
  }, [uploadedImage, rotation, imgPosition]);

  const handleImageUpload = (event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          const aspectRatio = img.width / img.height;
          const containerWidth = containerRef.current.clientWidth;
          const initialWidth = containerWidth * 0.4;
          const initialHeight = initialWidth / aspectRatio;

          setUploadedImage(e.target.result);
          setImgPosition({
            x: (containerWidth - initialWidth) / 2,
            y: 50
          });
          setImgSize({ width: initialWidth, height: initialHeight });
          setRotation(0);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  };

  const exportAsTexture = () => {
    if (!containerRef.current) return;

    const canvas = textureCanvasRef.current;
    const ctx = canvas.getContext("2d");

    // Set canvas size to match container with higher resolution
    const scale = 2; // Increase resolution by 2x
    canvas.width = containerRef.current.clientWidth * scale;
    canvas.height = containerRef.current.clientHeight * scale;

    // Enable high-quality image smoothing
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = 'high';

    // Draw white background
    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw the SVG
    const serializer = new XMLSerializer();
    const svgString = serializer.serializeToString(svgRef.current);
    const svgBlob = new Blob([svgString], { type: "image/svg+xml;charset=utf-8" });
    const url = URL.createObjectURL(svgBlob);

    const img = new Image();
    img.src = url;
    img.onload = () => {
      // Draw SVG at full size
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      if (uploadedImage && imgRef.current) {
        ctx.save();

        // Apply the exact same transformations as in the div
        ctx.translate(imgPosition.x * scale, imgPosition.y * scale);
        ctx.rotate(rotation * Math.PI / 180);

        // Draw image with exact dimensions from the div
        ctx.drawImage(
          imgRef.current.firstChild,
          0,
          0,
          imgSize.width * scale,
          imgSize.height * scale
        );
        ctx.restore();
      }

      URL.revokeObjectURL(url);

      // Export with maximum quality
      const textureUrl = canvas.toDataURL("image/png", 1.0);
      onTextureGenerated(textureUrl);
    };
  };

  return (
    <div className="flex flex-col h-full">
      {/* Controls */}
      <div className="flex flex-col space-y-4 mb-4">
        {/* Upload Image Control */}
        <div className="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
          <label className="text-sm font-medium text-gray-700">Upload Image:</label>
          <input
            type="file"
            accept="image/*"
            onChange={handleImageUpload}
            className="hidden"
            id="image-upload"
          />
          <label
            htmlFor="image-upload"
            className="w-full sm:w-auto px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors cursor-pointer flex items-center justify-center"
          >
            <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Choose File
          </label>
        </div>

        {/* Color Picker Control */}
        <div className="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
          <label className="text-sm font-medium text-gray-700">Color Picker:</label>
          <div className="relative w-full sm:w-auto">
            <input
              type="color"
              value={color}
              onChange={(e) => setColor(e.target.value)}
              className="w-full sm:w-12 h-12 rounded-lg cursor-pointer border-2 border-gray-300 hover:border-blue-500 transition-colors"
            />
          </div>
        </div>
      </div>

      {/* Canvas for texture generation */}
      <canvas ref={textureCanvasRef} style={{ display: "none" }} />

      {/* T-shirt Container */}
      <div
        ref={containerRef}
        className="relative w-full h-[300px] sm:h-[400px] md:h-[500px] bg-gray-900 rounded-lg shadow-lg overflow-auto perspective-1000"
      >
        {/* SVG for color selection */}
        <svg
          ref={svgRef}
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          xmlnsXlink="http://www.w3.org/1999/xlink"
          x="0px"
          y="0px"
          viewBox="0 0 6144 6144"
          className="absolute inset-0 w-full h-full z-10 transition-transform duration-300"
          style={{ transformStyle: 'preserve-3d' }}
          xmlSpace="preserve"
        >
          <g>
            <g>

              <path
                style={{ fill: "#FFFFFF" }}
                d="M4598.04,3673.76c-391.34,0-782.68-0.07-1174.03,0.21c-20.04,0.01-39.78-2.31-59.65-3.6
  c-5.94-0.38-10.3-4.92-8.91-10.86c1.66-7.08,0.96-12.62-3.24-18.61c-2.06-2.94-2.1-7.57-2.31-11.48
  c-0.36-6.65-0.13-13.33-0.13-19.99c0-498.01-0.01-996.02,0.04-1494.03c0-11.92-1.21-23.93,3.14-35.63
  c1.26-3.39,0.71-8.11-0.57-11.66c-3.37-9.39-0.03-20.3-6.8-28.86c-0.69-0.87-0.68-2.66-0.39-3.87c3.28-13.64-2.01-26.48-4.23-39.44
  c-5.37-31.42-12.63-62.52-18.01-93.94c-10.79-63.06-25.27-125.31-40.64-187.35c-11.85-47.84-24.66-95.44-37.31-143.08
  c-2.19-8.25-3.5-17.01-10.08-23.62c-1.55-1.56-2.42-5.09-1.85-7.24c2.42-9.11-1.46-17.25-3.78-25.39
  c-8.77-30.75-18.08-61.34-27.49-91.9c-2.52-8.17-4.19-16.84-10.76-23.36c-1.58-1.56-2.02-4.75-2.12-7.23
  c-0.86-20.01-10.41-47.95-21.23-62.95c-2.2-3.05-5.04-7.81-4.09-10.58c3.62-10.58-0.57-19.62-3.66-29.02
  c-15.22-46.2-30.32-92.44-45.8-138.55c-4-11.9-6.55-24.37-14.06-35.08c-2.32-3.31-1.9-8.9-1.81-13.43
  c0.09-4.29,3.04-7.34,7.08-8.83c21.83-8.02,43.66-16.06,65.56-23.89c60.84-21.77,121.67-43.58,182.58-65.13
  c55.27-19.55,110.69-38.69,165.98-58.18c89.84-31.66,179.65-63.45,269.46-95.2c84.79-29.98,169.57-59.97,254.35-89.96
  c42.7-15.11,85.4-30.23,128.1-45.34c3.77-1.33,7.64-2.41,11.33-3.93c13.27-5.49,25.91-4.38,38.35,2.71
  c15.02,8.56,29.53,18.26,46.87,21.92c1.24,0.26,2.52,1.04,3.47,1.92c20.59,19.05,46.8,27.73,71.78,38.51
  c28.85,12.45,59.08,20.69,89.95,26.39c4.45,0.82,9.17,0.03,13.76,0.19c3.2,0.11,7.06-0.46,9.44,1.09c6.83,4.46,13.42,5.1,20.8,1.86
  c5.9-2.59,11.72-1.92,17.1,1.78c10.33,7.1,21.63,6.45,32.61,2.85c9.22-3.02,18.4-2.58,27.68-2.34c3.26,0.08,7.25,0.15,9.61,1.94
  c9.96,7.56,21.36,6.39,32.61,6.48c5.33,0.04,10.68,0.17,15.99-0.21c3.93-0.28,8.44-0.28,11.59-2.21
  c15.01-9.23,30.38-7.08,46.22-3.15c10.44,2.59,21.07,3.82,30.54-3.57c4.01-3.13,8.42-3.24,13.25-1.86
  c4.42,1.26,10.53,4.15,13.3,2.34c14.54-9.47,31.1-1.63,46.13-6.78c15.71-5.38,32.25-8.28,48.08-13.35
  c15.21-4.87,30.2-10.59,44.85-16.93c14.67-6.34,28.83-13.85,43.16-20.95c4.17-2.07,8.84-3.79,12.11-6.91
  c6.91-6.59,14.27-11.6,23.89-13.31c3.11-0.55,6.7-2.3,8.68-4.66c8.35-9.98,20.96-11,31.76-15.63c8.3-3.56,17.06-1.55,25.41,1.29
  c16.4,5.57,32.82,11.1,49.2,16.74c43.43,14.96,86.9,29.85,130.25,45.05c12.54,4.4,24.54,10.35,37.13,14.58
  c66.89,22.49,132.71,47.97,199.54,70.6c20.18,6.83,40,14.71,60.24,21.33c41.12,13.45,81.25,29.66,122.3,43.22
  c22.74,7.51,45.02,16.25,67.66,23.97c64.89,22.15,128.92,46.71,193.88,68.62c22.69,7.65,44.98,16.38,67.67,23.94
  c49.25,16.41,97.59,35.3,146.62,52.3c11.37,3.94,15.99,13.03,10.47,23.45c-16.05,30.28-22.91,63.8-34.45,95.65
  c-9.98,27.55-18.49,55.63-27.64,83.48c-0.42,1.26-0.43,2.76-1.13,3.82c-8.21,12.42,3.09,30.14-11.12,40.9
  c-4.76,13.1-9.78,26.12-14.2,39.34c-4.65,13.89-8.95,27.91-12.95,42c-2.15,7.55-6.25,14.8-4.02,23.3c0.58,2.19-0.15,5.76-1.68,7.28
  c-6.58,6.53-8.31,15.15-10.7,23.38c-26.79,92.11-52.9,184.43-74.11,278.02c-12.36,54.54-23.28,109.42-34.41,164.23
  c-6.35,31.28-11.96,62.72-17.6,94.14c-1.28,7.11-1.29,14.45-1.92,21.68c-0.23,2.59,0.21,5.61-0.98,7.66
  c-3.2,5.51-4.14,11.01-2.96,17.26c0.45,2.38-0.02,5.51-1.29,7.54c-3.94,6.34-2.79,12.4-1.18,19.17c1.67,7.01,2.01,14.46,2.04,21.73
  c0.19,36.67,0.08,73.33,0.08,110c0,254.67,0.01,509.34-0.03,764.02c0,12.53,1.89,25.36-6.55,36.59c-1.75,2.33-1.48,6.4-1.61,9.68
  c-0.25,5.99-0.11,12-0.11,18c0,194,0,388.01-0.03,582.01c0,7.32,0.32,14.75-0.73,21.95c-1.65,11.34-6.98,20.11-19.65,21.97
  c-6.56,0.96-13.07,2.42-19.66,2.88c-7.3,0.51-14.66,0.15-21.99,0.15C5383.39,3673.76,4990.71,3673.76,4598.04,3673.76z"
              />
              <path
                style={{ fill: "#FFFFFF" }}
                d="M2781.95,2046.14c-2.13,3.77-4.22,7.13-5.98,10.66c-3.2,6.44-2.4,12.92,0.23,19.34
  c2.16,5.27,2.48,10.41-1.41,15.05c-6.35,7.58-6.03,15.92-2.71,24.45c2.61,6.71,2.64,13.04-1.74,18.95
  c-4.26,5.74-4.62,12.31-4.56,19.05c0.05,6.67-0.01,13.33-0.01,20c0,487.98,0,975.96-0.02,1463.95c0,8.66,0.43,17.4-0.52,25.97
  c-2.08,18.79-18.48,34.02-37.51,34.89c-12.64,0.58-25.33,0.2-37.99,0.21c-36.67,0.02-73.33,0.01-110,0.01
  c-8.65,0-17.2,0.07-25.63-3.03c-4.87-1.79-10.41-2.03-15.69-2.34c-6.65-0.38-13.33-0.14-19.99-0.14
  c-716.64,0-1433.28-0.01-2149.92,0.04c-13.92,0-28.05-1.58-41.39,4.41c-1.71,0.77-4.35,1.24-5.84,0.47
  c-11.47-5.98-25.56-8.83-31.03-22.55c-2.41-6.04-3.34-12.85-3.94-19.4c-0.67-7.27-0.21-14.65-0.21-21.99
  c0-489.32,0-978.63-0.01-1467.95c0-6.67,0.15-13.34-0.12-20c-0.16-3.95,0.25-8.72-1.75-11.67c-6.19-9.11-7.26-17.84-3.07-28.2
  c2.53-6.26,1-13.17-3.8-18.74c-3.91-4.54-4.04-9.64-1.93-14.99c3.64-9.27,3.93-18.06-2.97-26.25c-2.87-3.41-1.43-7.37-0.54-11.39
  c0.98-4.4,2.73-10.67,0.62-13.34c-6.74-8.57-5.71-16.95-2.85-26.1c0.56-1.8,0.49-4.2-0.23-5.91c-3.13-7.38-5.32-14.68-4.2-23
  c0.36-2.7-2.9-5.76-4.09-8.82c-0.94-2.4-2.38-5.44-1.64-7.51c5.58-15.66-1.36-30.17-3.53-45.12c-1.99-13.73-5.48-27.14-6.55-41.13
  c-1.1-14.49-5.15-28.74-7.79-43.12c-16.85-91.74-38.97-182.25-63.49-272.19c-2.77-10.15-3.76-21.13-11.9-29.24
  c-1.2-1.2-2-3.84-1.59-5.46c2.2-8.56,0.33-15.72-5.92-21.97c-1.27-1.27-2.3-3.58-2.17-5.32c1.61-22.11-8.04-41.36-15.25-61.23
  c-0.68-1.87-1.72-3.68-2.05-5.61c-5.07-29.69-16.27-57.62-24.77-86.32c-2.1-7.1-4.6-13.81-10.39-18.98
  c-4.18-3.73-6.63-8.64-4.31-14.35c2.49-6.15,0.66-11.7-1.23-17.46c-7.27-22.16-14.37-44.37-21.65-66.52
  c-2.08-6.34-4.82-12.2-9.74-17.18c-6.96-7.04-9.82-15.53-6.68-25.61c1.16-3.73,1.16-7.87,1.42-11.84
  c1.08-16.56,9.16-26.68,24.5-31.79c10.72-3.57,21.23-7.83,31.72-12.05c68.62-27.6,137.25-55.16,205.79-82.94
  c77.76-31.51,155.82-62.25,233.39-94.2c36.31-14.96,73.02-28.87,109.3-43.91c36.31-15.05,72.87-29.5,109.31-44.22
  c109.96-44.42,219.91-88.87,329.89-133.24c8.64-3.49,17.34-6.96,26.28-9.53c10.57-3.04,18.22,0.53,23.57,9.72
  c3.67,6.31,7.6,12.47,10.97,18.93c5.88,11.3,4.13,23.24,2.14,35.08c-0.66,3.91-2.63,7.67-2.87,11.56
  c-0.5,7.92-1.41,16.1,4.38,22.91c3.83,4.52,3.94,9.47,2.23,15.01c-1.35,4.37-3.52,9.67-2.21,13.49
  c6.11,17.78,2.86,36.79,8.23,54.63c5.18,17.21,8.48,35.03,14.34,51.98c6.08,17.58,13.65,34.72,21.64,51.54
  c10.34,21.76,23.86,41.6,39.83,59.7c4.84,5.48,9.51,10.9,17.49,12.46c7.03,1.38,11.68,6.46,13.31,13.47
  c1.28,5.52,3.9,10.01,8.37,13.17c20.02,14.13,38.21,31.34,62.9,37.68c1.26,0.32,2.53,0.94,3.59,1.71
  c22.92,16.39,50.17,20.79,76.53,27.66c2.56,0.67,5.3,1.53,7.84,1.24c9.85-1.11,19.23-2.45,28.73,3.28
  c3.8,2.29,10.76,1.31,15.51-0.37c9.14-3.23,18.32-3.03,27.63-3.03c10,0,20.01-0.33,29.99,0.01c5.92,0.2,12.01,0.71,17.66,2.34
  c8.12,2.34,15.66,3.04,22.87-2.16c3.6-2.59,7.36-1.76,11.43-1.19c5.18,0.73,10.72,1.24,15.76,0.18
  c46.8-9.81,90.74-26.47,129.47-55.29c9.64-7.17,18.87-14.49,25.74-24.78c3.95-5.91,10.14-10.51,15.86-15
  c7.44-5.83,13.61-12.51,18.91-20.38c5.92-8.8,13.67-16.39,19.34-25.32c19.08-30.01,32.99-62.43,42.34-96.7
  c4.38-16.04,7.71-32.39,11.13-48.67c0.94-4.47,1.42-9.43,0.47-13.81c-1.34-6.17-1.41-11.28,2.01-17.09
  c2.06-3.51,2.43-9.27,1.14-13.22c-2.47-7.55-2.81-13.71,2.29-20.53c5.66-7.56,4.47-16.63,1.41-24.93
  c-3.37-9.14-2.66-18.39-2.25-27.67c0.14-3.23,1.13-6.55,2.37-9.58c3.02-7.36,6.73-14.45,9.56-21.87
  c3.28-8.61,7.74-15.37,17.8-16.76c3.21-0.45,6.24-2.14,9.91-3.46c21.48,15.09,46.63,22.19,70.56,31.9
  c124.72,50.62,249.66,100.69,374.49,151.01c151.41,61.04,302.79,122.13,454.18,183.22c43.87,17.7,87.56,35.84,131.63,53.03
  c13.59,5.3,25.41,14.55,40.16,17.22c3.85,0.7,6.34,6.72,4.04,9.82c-8.74,11.77-7.81,26.57-12.96,39.48
  c-5.18,12.97-9,26.48-13.38,39.77c-3.75,11.39-7.66,22.73-11.09,34.21c-1.89,6.33-2.95,12.91-4.36,19.39
  c-0.7,3.22-0.52,6.95-2.15,9.58c-8.6,13.85-11.89,29.64-16.68,44.82c-25.65,81.32-49.82,163.06-71.62,245.51
  c-21.96,83.09-41.07,166.82-56.96,251.28c-4.78,25.41-8.71,50.98-13.03,76.47c4.4,13.95-7.88,26.53-3.33,40.5
  c-4.48,9.2-6.89,18.66-3.43,28.81c-5.73,9.69-6.93,19.8-3.01,30.49c0.38,1.04-0.08,2.9-0.85,3.76
  C2775.26,2025.53,2777.98,2035.83,2781.95,2046.14z"
              />
              <path
                style={{ fill: "#FFFFFF" }}
                d="M2414.42,5698.48c-1.65,3.06-5.02,8.1-7.21,13.62c-3.55,8.96-9.73,14.13-19.14,15.4
  c-7.22,0.97-14.49,2.27-21.74,2.33c-30,0.24-60,0.06-90,0.05c-146.66-0.02-293.33,0-439.99-0.06
  c-356.66-0.15-713.31-0.35-1069.97-0.51c-13.28-0.01-26.29,0.39-39.5,4.05c-11.92,3.3-24.91,3.7-36.52-4.45
  c-4.04-2.84-9.88-3.13-15.43-4.74c-2.87-13.29-6.04-26.14-8.38-39.13c-4.72-26.17-8.79-52.46-13.6-78.61
  c-1.43-7.75-4.43-15.21-6.75-22.8c-0.57-1.88-1.87-3.73-1.83-5.57c0.51-22.75-5.17-44.57-9.12-66.73
  c-3.97-22.25-7.94-44.48-12.09-66.68c-3.16-16.89-5.81-34-8.96-50.98c-5.21-28.02-12.01-55.88-14.97-84.14
  c-2.98-28.49-11.11-55.9-14.08-84.38c-2.75-26.37-9.05-52.38-14.05-78.49c-0.98-5.14-3.18-10.05-4.83-15.06
  c-0.62-1.88-2.03-3.81-1.84-5.58c2.54-23.07-5.56-44.58-9.38-66.73c-2.47-14.35-6.56-28.61-5.05-43.47
  c0.4-3.97-0.25-8.28,1.09-11.87c1.55-4.14,4.26-8.16,7.42-11.28c3.23-3.19,8.37-4.55,11.32-7.91c6.8-7.73,14.79-8.03,23.67-5.61
  c2.57,0.7,5.01,1.99,7.61,2.4c7.99,1.25,16.05,1.86,23.12-3.2c7.88-5.64,15.94-5.18,24.68-2.16c9.81,3.4,19.51,3.64,28.41-3.31
  c5.21-4.07,11.28-3.6,17.16-1.41c11.28,4.22,21.86,4.4,32.14-3.23c5.08-3.77,11.73-3.53,17.38-1.44
  c11.99,4.43,23.11,5.19,34.11-2.81c4.5-3.28,10.28-2.73,15.44-0.79c11.91,4.48,23.01,4.49,34.34-2.63
  c3.99-2.5,10.73-3.25,15.24-1.79c13.4,4.34,25.7,5.4,38.08-3.1c5.06-3.48,11.64-2.5,17.43-0.22c10.64,4.19,20.64,4.03,30.32-2.89
  c5.26-3.76,11.41-3.36,17.28-1.19c11.24,4.15,21.79,4.63,32.17-2.99c5.69-4.18,12.88-3.55,19.27-1.13
  c11.39,4.31,21.89,4.25,32.19-3.17c4.53-3.26,10.28-2.94,15.44-0.98c11.93,4.53,23,4.77,34.05-3.14
  c5.66-4.05,12.88-2.77,19.33-0.44c11.32,4.09,21.78,4.15,32.23-3.26c3.21-2.28,9.36-2.62,13.28-1.27
  c12.71,4.35,24.47,5.15,36.17-2.9c5.19-3.57,11.56-2.93,17.41-0.88c13.25,4.65,25.46,4.4,38.16-3.25c8.04-4.85,17.97-2.5,27.3-0.5
  c8.35,1.79,17.04,2.43,25.6,2.6c4.44,0.08,9.53-0.97,13.27-3.23c13.78-8.34,28.55-6.35,42.68-3.46c9.25,1.9,18.26,3.15,27.59,3.06
  c10.67-0.1,21.33-0.26,32-0.21c7.42,0.03,14.28-0.93,21.02-4.88c4.29-2.51,10.1-3.36,15.23-3.38
  c56.66-0.23,113.33-0.19,169.99-0.06c4.57,0.01,10.14-0.17,13.53,2.2c9.6,6.7,20.13,6.03,30.73,6.14c10,0.1,20.01,0.51,29.99,0.11
  c6.57-0.26,13.14-1.44,19.63-2.65c14.52-2.71,28.2-3.58,42.54,3.55c12.69,6.3,27.28,4.25,41.06,0.63
  c11.9-3.13,23.29-4.07,34.4,3.52c7,4.77,15.5,3.86,23.2,1.16c10-3.5,19.09-4.25,28.35,2.53c6.92,5.07,15.52,4.46,23.08,1.62
  c9.61-3.6,17.54-3,26.24,3c6.82,4.7,15.52,3.58,23.17,0.62c8.82-3.42,16.56-2.88,24.52,2.61c7.06,4.88,15.38,4.46,23.08,1.51
  c8.77-3.37,16.62-3.44,24.53,2.28c6.39,4.62,14.17,4.89,21.13,2.36c10.76-3.92,20.17-4.18,30.29,2.45
  c7.54,4.94,16.76,3.82,25.13,0.6c8.14-3.13,15.2-2.53,22.52,2.73c7.66,5.5,16.6,4.42,24.96,1.42c8.08-2.9,15.23-3.2,22.57,2.28
  c7.62,5.7,16.58,4.83,24.9,1.86c9.47-3.38,17.98-3.52,26.5,2.53c6.48,4.6,14.03,4.33,21.1,1.63c8.68-3.32,16.58-3.8,24.57,1.94
  c7.04,5.06,15.3,4.99,23.01,2.15c10.81-3.98,20.24-3.58,30.19,3.16c6.83,4.63,15.51,3.46,23.19,0.5
  c7.42-2.86,14.09-2.84,20.78,1.93c7.7,5.48,16.64,5.41,24.95,2.66c9.46-3.13,17.52-4.04,26.28,2.5c6.74,5.03,15.49,3.96,23.13,1.13
  c8.81-3.27,16.34-3.23,24.46,2.47c3.97,2.79,10.07,2.55,15.21,3.64c13.35,2.82,25.34,7.34,32.71,20.34
  c4.73,8.35,6.26,16.33,1.01,24.37c-4.3,6.59-6.46,12.9-3.57,20.62c0.86,2.3,1.3,5.97,0.07,7.63c-5.57,7.55-4.36,16-5.61,24.44
  c-1.53,10.33-5.64,20.13-2.94,30.95c0.38,1.53-1.16,3.74-2.23,5.37c-3.13,4.79-4.15,10.11-2.39,15.3
  c2.13,6.28,1.2,11.33-2.26,16.94c-1.86,3.02-1.46,7.59-1.58,11.47c-0.06,1.9,1.86,4.05,1.43,5.71c-1.63,6.25-4.5,12.23-5.68,18.54
  c-1.05,5.58,3.68,11.22-0.4,17.35c-2.43,3.65-4.26,8.7-3.95,12.95c0.54,7.47-0.63,14.01-2.96,21.17
  c-1.89,5.78,1.4,13.06,0.67,19.47c-0.73,6.35-5.72,12.68-5.06,18.59c0.86,7.69,1.07,14.16-3.47,20.7c-1.31,1.89-1.52,5.4-0.79,7.7
  c2.36,7.41,2.77,14.02-2.62,20.61c-1.83,2.24-2.14,6.37-1.88,9.53c0.5,6.02,1.21,11.55-2.36,17.28c-1.9,3.04-2.21,7.9-1.46,11.58
  c1.42,6.9,0.61,12.75-2.95,18.93c-3.61,6.27,0.78,13,0.68,19.49c-0.08,6.52-7.79,11.34-5.5,18.6c2.34,7.39,2.76,13.89-2.47,20.62
  c-2.11,2.71-2.38,7.76-1.76,11.46c0.93,5.63,0.28,10.37-2.64,15.23c-1.28,2.13-1.79,5.16-1.58,7.69
  c0.71,8.54,2.06,16.87-3.27,24.84c-1.53,2.28-1.1,6.76-0.05,9.69c2.24,6.32,0.96,11.35-2.38,16.94c-1.82,3.06-2.47,8.05-1.33,11.39
  c2.44,7.13-0.19,12.32-2.75,18.72C2413.68,5681.16,2414.95,5688.97,2414.42,5698.48z"
              />
              <path
                style={{ fill: "#FFFFFF" }}
                d="M3678.8,5481.7c2.41-9.37,6.12-18.41-1.54-26.88c-1.36-1.5-1.48-5.41-0.55-7.47
  c4.32-9.52-4.89-16.46-4.43-24.51c0.46-8.04,2.5-15.33-2.81-22.8c-4.77-6.72,1.95-13.98,0.64-21.35c-1.24-7.01-9-12.02-5.42-20.49
  c2.43-5.73,2.15-11.83-2.09-17.01c-2.83-3.45-3.02-7.05-1.74-11.19c2.03-6.61,1.59-12.98-1.73-19.34c-1.41-2.7-1.81-6.36-1.48-9.46
  c0.73-6.79,0.75-13.17-2.92-19.33c-1.24-2.07-1.89-5.3-1.25-7.55c2.7-9.52-2.22-16.66-7.42-23.77c3.59-9.95,6.74-19.64-1.36-28.49
  c-0.4-0.44-0.79-1.4-0.58-1.83c6.28-13.28-3.91-25.59-2.3-38.7c0.54-4.37-1.19-9.06-2.09-13.55c-0.64-3.16-2.22-6.23-2.37-9.38
  c-0.63-13.51-0.5-13.51-6.88-24.8c2.69-8.83,6.71-18.58-1.63-27.44c-0.42-0.45-0.87-1.37-0.68-1.8
  c5.51-12.67-2.86-24.42-2.33-36.69c0.26-6.08-1.6-11.65-2.46-17.41c-2.29-15.39-5.71-31.08-0.31-46.69
  c1.63-4.7,4.21-8.37,8.8-10.24c5.54-2.25,11.08-4.91,16.88-6.03c8.5-1.63,16.79-2.75,24.51-7.54c3.3-2.05,9.24-1.56,13.34-0.25
  c11.44,3.67,21.93,4.2,32.19-3.45c5.07-3.78,11.72-3.55,17.37-1.47c11.98,4.41,23.11,5.23,34.1-2.81
  c4.49-3.28,10.3-2.86,15.43-0.83c11.31,4.49,21.86,4.48,32.16-2.99c4.53-3.28,10.28-3.12,15.42-1.12
  c11.25,4.38,21.83,4.84,32.21-2.64c5.22-3.75,11.41-3.01,17.31-0.93c11.88,4.21,23.37,4.71,34.29-2.95c4.1-2.88,8.77-2.82,13.4-1.1
  c11.21,4.15,21.74,4.51,32.23-2.96c3.24-2.31,9.33-2.84,13.25-1.56c12.68,4.14,24.14,5.16,36.13-2.94
  c4.11-2.78,11.92-2.29,17.23-0.65c11.49,3.55,21.91,4.47,32.29-2.99c5.21-3.74,11.45-3.02,17.31-0.82
  c11.3,4.25,21.92,4.32,32.09-3.44c4.54-3.47,10.21-2.6,15.38-0.7c11.22,4.13,21.9,4.83,32.12-3.04c4.53-3.49,10.17-3.04,15.35-1.1
  c11.92,4.49,23.25,4.76,34.2-2.94c4.73-3.32,10.14-2.46,15.37-0.58c10.53,3.78,20.6,4.34,30.33-2.83
  c6.44-4.74,13.82-3.32,21.15-1.51c5.75,1.42,11.71,2.67,17.58,2.64c4.44-0.02,9.45-1.25,13.18-3.58
  c9.33-5.81,19.09-6.32,28.77-2.86c10.49,3.75,21.05,2.76,31.64,2.5c3.86-0.09,8.37-0.68,11.42-2.76
  c12.85-8.76,27.46-7.59,40.57-4.52c14.64,3.43,28.96,3.37,43.54,3.53c6,0.06,12.01,0.09,17.99-0.22c3.95-0.2,8.81,0.25,11.62-1.82
  c10.69-7.87,22.75-6.49,34.63-6.51c50.66-0.08,101.32-0.01,151.98-0.02c8.68,0,17.08,0.02,24.88,5.41
  c3.48,2.4,8.83,2.74,13.37,2.87c14.65,0.42,29.33,0.46,43.99,0.33c4.61-0.04,9.56-0.16,13.75-1.8c11.05-4.34,22.35-2.86,33.61-2.63
  c3.23,0.07,6.9,0.61,9.58,2.23c15.58,9.44,31.84,7.32,48.2,3.33c10.04-2.45,19.38-2.96,28.64,3.31c8.27,5.6,18.13,4.83,27.04,1.96
  c10.14-3.27,19.05-4.02,28.44,2.34c7.64,5.18,16.75,4.37,25.08,1.33c9.47-3.44,17.97-3.46,26.5,2.55
  c6.49,4.57,14.01,4.2,21.12,1.58c9.98-3.67,19.07-4.11,28.33,2.59c6.91,5,15.5,4.33,23.1,1.52c9.51-3.51,17.6-3.17,26.44,2.49
  c8.25,5.28,18.04,4.32,27.07,1.1c8.11-2.89,15.23-3.09,22.57,2.36c7.63,5.67,16.57,4.68,24.92,1.78
  c10.11-3.51,19.13-3.71,28.29,3.04c6.24,4.6,14.34,4.15,21.23,1.68c10.09-3.61,18.93-4.18,28.32,2.3
  c6.97,4.81,15.37,3.55,23.14,0.71c9.32-3.4,17.94-3.47,26.45,2.78c6.99,5.14,15.46,4.55,23.06,1.9c10.1-3.51,19.15-4.19,28.4,2.38
  c6.43,4.57,14.06,3.9,21.15,1.22c10.05-3.8,19.11-3.72,28.27,3c6.24,4.58,14.34,4.15,21.24,1.67c10.1-3.62,18.94-4.16,28.32,2.33
  c6.88,4.76,15.75,4.31,23.26,1.77c10.16-3.44,18.72-4.08,28.17,2.59c6.72,4.75,15.53,3.52,23.16,0.47
  c9.73-3.9,18.17-2.84,25.78,4.46c0.94,0.9,2.14,1.75,3.37,2.12c11.98,3.54,17.57,13.16,23.01,23.25c2.79,5.17,4.23,10.13,0.5,14.88
  c-6.12,7.78-7.48,17.18-8.82,26.23c-5.16,34.83-12.04,69.35-18.12,104.01c-4.93,28.1-9.63,56.23-14.59,84.32
  c-1.85,10.47-4.14,20.85-6.19,31.28c-0.64,3.26-1.39,6.52-1.69,9.82c-0.67,7.61,2.79,14.9-2.21,23.07
  c-3.28,5.35-2.74,13.59-4.84,20.59c-4.17,13.95-5.95,28.63-8.48,43.05c-7.6,43.21-15.19,86.42-22.61,129.66
  c-4.94,28.82-9.3,57.74-14.43,86.52c-6.64,37.28-13.68,74.5-20.83,111.69c-1.12,5.83-3.46,11.48-5.73,17
  c-1.23,3-2.89,6.79-5.45,8.12c-15.73,8.14-31.13,19.43-50.27,12.83c-10.45-3.61-20.87-3.83-31.51-3.83
  c-282.62,0.08-565.25,0.17-847.87,0.28c-250.63,0.1-501.26,0.24-751.89,0.34c-9.97,0-19.87,0.16-29.69-2.93
  c-6.94-2.18-12.28-5.61-14.54-12.35c-4.57-13.64-11.08-26.84-9.89-41.94c0.3-3.83-0.1-8.34-1.89-11.58
  c-2.82-5.09-3.43-9.91-2.05-15.3c1.89-7.39-5.18-12.13-5.71-18.5c-0.53-6.48,1.19-13.12,1.19-19.69c0-2.36-2.5-4.63-3.24-7.12
  c-0.9-3.01-2.14-6.45-1.49-9.3c1.71-7.45,1.86-14.28-1.98-21.27c-1.43-2.6-0.88-6.32-1.15-9.53c-0.27-3.28,0.7-7.28-0.86-9.71
  c-4.25-6.63-5.89-13.02-3.18-20.66c0.79-2.23,0.43-5.82-0.92-7.67c-4.78-6.53-5.18-13.04-2.92-20.66
  C3688.06,5493.95,3682.3,5487.94,3678.8,5481.7z"
              />
              <path
                style={{ fill: "#FFFFFF" }}
                d="M3049.94,4241.6c797.97,0,1595.94,0,2393.91,0.01c9.33,0,18.69-0.26,27.99,0.35
  c11.83,0.77,20.56,5.47,27.58,16.51c7.92,12.48,12,24.72,11.24,39.29c-0.67,12.63-0.33,25.33-0.16,37.99
  c0.17,12.46-8.11,20.67-14.6,29.75c-1.05,1.47-3.25,2.57-5.1,2.94c-12.89,2.63-25.06,8.51-39.08,5.79
  c-9.01-1.75-18.6-0.58-27.93-0.58c-1199.29-0.01-2398.58-0.01-3597.87-0.01c-385.99,0-771.97-0.01-1157.96,0.04
  c-11.92,0-23.91-1.12-35.55,3.62c-3.12,1.27-7.81-0.07-11.35-1.38c-5.56-2.07-10.79-5.06-16.08-7.8c-1.75-0.91-3.97-1.9-4.77-3.47
  c-6.22-12.31-13.15-24.32-11.34-39.16c1.12-9.16,2.18-18.69,0.86-27.71c-1.95-13.38,2.87-24.91,7.12-36.68
  c1.25-3.45,4.46-6.99,7.71-8.76c10.39-5.67,20.52-12.35,33.47-10.85c6.58,0.76,13.32,0.12,19.98,0.12
  C1455.33,4241.6,2252.63,4241.6,3049.94,4241.6z"
              />
              <path
                style={{ fill: "#FFFFFF" }}
                d="M3953.01,305.87c-9.95-5.43-20.7-4.81-31.36-4.81c-97.98,0-195.96,0-293.94,0
  c-479.91,0-959.82-0.01-1439.73,0.05c-15.22,0-30.65-1.8-45.41,4.4c-2.73,1.15-7.16,0.98-9.64-0.52
  c-8.49-5.13-16.71-10.8-24.54-16.89c-7.82-6.08-11.14-14.38-10.88-24.54c0.43-16.65-0.05-33.33,0.15-49.99
  c0.21-16.37,10.78-30.75,26.53-35.54c6.29-1.91,13-2.8,19.59-3.26c7.96-0.56,15.99-0.19,23.99-0.19
  c579.22,0,1158.45,0.01,1737.67-0.09c14.58,0,29.09,0.45,43.78-2.17c11.12-1.98,22.27,3.93,31.44,10.41
  c7.38,5.22,9.12,14.45,9.18,23.34c0.14,21.33,0.14,42.66-0.08,63.98c-0.04,3.92-1.12,7.89-2.15,11.72
  c-1.82,6.79-5.77,11.76-12.57,14.44C3968.28,298.89,3961.71,302.04,3953.01,305.87z"
              />
              <path
                style={{ fill: "#FFFFFF" }}
                d="M3048.58,397.89c297.87,0,595.74,0,893.61,0.01c7.33,0,14.7-0.35,21.98,0.34
  c17.21,1.61,25.36,9.85,25.7,27.07c0.52,25.98,0.15,51.97,0.29,77.96c0.04,6.94-3.1,11.78-9.52,13.57
  c-7.65,2.12-15.52,3.67-23.39,4.66c-5.91,0.74-11.98,0.2-17.97,0.2c-594.41,0-1188.82,0-1783.23,0c-6.66,0-13.35,0.26-19.99-0.2
  c-22.96-1.58-38.04-17.3-38.39-40.1c-0.24-15.99,0.8-32.04-0.27-47.96c-1.15-17.19,9.33-25.36,22.16-31.92
  c4.55-2.32,10.19-2.98,15.42-3.39c7.29-0.57,14.65-0.23,21.98-0.23C2454.18,397.89,2751.38,397.89,3048.58,397.89z"
              />
              <path
                style={{ fill: "#FFFFFF" }}
                d="M5476.96,5872.78c-3.87,8.38-7.55,15.46-10.45,22.85c-2.9,7.38-7.44,12.23-15.3,14.31
  c-5.09,1.35-9.75,4.27-14.83,5.69c-3.63,1.01-8.09,1.93-11.38,0.72c-8.44-3.11-17.02-2.91-25.66-2.92
  c-42.67-0.04-85.33-0.01-128-0.02c-125.33-0.03-250.66-0.08-375.99-0.09c-11.97,0-23.8-0.21-35.52,4.02
  c-6,2.16-13.16,1.43-19.79,1.43c-144,0.02-287.99-0.03-431.99-0.08c-204.66-0.08-409.32-0.17-613.99-0.25
  c-18.99,3.77-34.5-7.39-51.44-12.23c-6.21-1.78-9.47-7.61-10.79-13.55c-3.46-15.54-8.65-30.7-9.87-46.75
  c-0.55-7.27-2.76-14.41-3.26-21.68c-1.87-27.12,2.79-33.75,31.23-37.67c5.24-0.72,10.65-0.29,15.98-0.28
  c347.99,0.08,695.99,0.13,1043.98,0.26c199.33,0.07,398.66,0.27,597.99,0.4c4.67,0,9.6,0.95,13.95-0.24
  c15.65-4.28,30.09,3.33,45.21,3.89c4.34,0.16,7.35,3.58,8.3,7.65c1.35,5.79,2.09,11.76,2.68,17.69c0.79,7.92,1.28,15.87,1.71,23.82
  c0.14,2.57,0.66,5.96-0.68,7.63C5472.23,5855.9,5474.8,5864.93,5476.96,5872.78z"
              />
              <path
                style={{ fill: "#FFFFFF" }}
                d="M2413.41,5819.89c-7.84,17.02-12.12,34.22-15.3,51.74c-0.95,5.23-1.73,10.53-3.19,15.62
  c-3.28,11.42-9.91,18.45-21.64,23.81c-13.39,6.12-26.32,7.93-40.38,7.82c-31.33-0.23-62.65-0.09-93.98-0.05
  c-8.68,0.01-17.08-0.73-25.61-3.17c-7.51-2.15-15.77-2.25-23.7-2.26c-67.99-0.12-135.97-0.02-203.96,0.01
  c-152.64,0.06-305.27,0.12-457.91,0.18c-273.28,0.1-546.56,0.21-819.84,0.27c-11.29,0-22.54,0.49-33.7-2.91
  c-7.76-2.37-13.4-6.39-15.59-13.92c-3.83-13.16-10.13-25.82-8.78-40.18c0.3-3.24,0.46-7.18-1.06-9.78
  c-6.71-11.51-2.45-23.45-1.73-35.07c0.56-9.02,4.9-16.63,15.06-18.79c1.28-0.27,2.68-0.75,3.66-1.57
  c12.85-10.69,28.1-9.98,43.52-9.97c208.63,0.07,417.25-0.05,625.88-0.11c11.3,0,22.42-0.03,33.53,3.8
  c6.66,2.3,14.48,1.63,21.78,1.63c68.65,0.07,137.31-0.02,205.96-0.04c187.96-0.06,375.93-0.1,563.89-0.19
  c66.65-0.03,133.31-0.07,199.96-0.32c10.8-0.04,21.23,1.2,31.39,4.86c6.58,2.37,11.52,6.07,13.96,13.11
  C2407.34,5809.36,2410.33,5813.87,2413.41,5819.89z"
              />
            </g>
          </g>
        </svg>

        {/* Uploaded Image */}
        {uploadedImage && (
          <div
            ref={imgRef}
            className="resize-drag absolute z-20"
            style={{
              width: `${imgSize.width}px`,
              height: `${imgSize.height}px`,
              cursor: "move",
              userSelect: "none",
              border: "2px solid #2196F3",
              borderRadius: "4px",
              overflow: "hidden",
              transform: `translate(${imgPosition.x}px, ${imgPosition.y}px) rotate(${rotation}deg)`,
            }}
          >
            <img
              src={uploadedImage}
              alt="Uploaded"
              className="w-full h-full object-cover pointer-events-none"
            />
            {/* Resize handles */}
            <div className="resize-handle top-left absolute -top-1 -left-1 w-2 h-2 bg-blue-500 rounded-full cursor-nw-resize" />
            <div className="resize-handle top-right absolute -top-1 -right-1 w-2 h-2 bg-blue-500 rounded-full cursor-ne-resize" />
            <div className="resize-handle bottom-left absolute -bottom-1 -left-1 w-2 h-2 bg-blue-500 rounded-full cursor-sw-resize" />
            <div className="resize-handle bottom-right absolute -bottom-1 -right-1 w-2 h-2 bg-blue-500 rounded-full cursor-se-resize" />
            <div className="resize-handle top absolute -top-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full cursor-n-resize" />
            <div className="resize-handle bottom absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full cursor-s-resize" />
          </div>
        )}
      </div>
    </div>
  );
};

export default Layer;